<!DOCTYPE html>
<html>
<head>
  <title>Chat with {{ ai_name }}</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #e0e0e0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      margin: 0;
      height: 100vh;
      box-sizing: border-box;
    }

    h2 {
      color: #fff;
      margin-bottom: 15px;
    }

    #chatBox {
      width: 100%;
      max-width: 800px;
      height: 75vh;
      overflow-y: auto;
      border-radius: 10px;
      padding: 15px;
      background-color: #1e1e1e;
      box-shadow: 0 2px 10px rgba(0,0,0,0.5);
      margin-bottom: 10px;
      display: flex;
      flex-direction: column;
    }

    .message-container {
      display: flex;
      align-items: flex-end;
      margin: 5px 0;
      width: 100%;
    }

    .message {
      padding: 10px 15px;
      border-radius: 20px;
      word-wrap: break-word;
      max-width: 70%;
    }

    .user-message-container {
      justify-content: flex-start;
    }

    .user-message {
      background-color: #3a3f45;
      text-align: left;
      color: #fff;
    }

    .ai-message-container {
      justify-content: flex-end;
    }

    .ai-message {
      background-color: #0a84ff;
      text-align: left;
      color: #fff;
      margin-right: 8px;
    }

    .avatar {
      width: 35px;
      height: 35px;
      border-radius: 50%;
    }

    #inputContainer {
      width: 100%;
      max-width: 800px;
      display: flex;
      gap: 10px;
      margin-top: auto;
    }

    #userInput {
      flex: 1;
      padding: 12px;
      border-radius: 20px;
      border: 1px solid #444;
      outline: none;
      font-size: 16px;
      background-color: #1e1e1e;
      color: #fff;
    }
    #sendBtn {
      padding: 12px 25px;
      border-radius: 20px;
      border: none;
      background-color: #fb0202;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }
    #sendBtn:hover {
      background-color: #ff0000;
    }
    .typing {
      display: flex;
      gap: 5px;
      align-items: center;
    }
    .dot {
      width: 8px;
      height: 8px;
      background-color: #fff;
      border-radius: 50%;
      animation: blink 1.4s infinite both;
    }
    .dot:nth-child(2) {
      animation-delay: 0.2s;
    }
    .dot:nth-child(3) {
      animation-delay: 0.4s;
    }
    @keyframes blink {
      0%, 80%, 100% { opacity: 0; }
      40% { opacity: 1; }
    }
  </style>
</head>
<body>
  <h2>Chat with {{ ai_name }}</h2>
  <div id="chatBox"></div>

  <div id="inputContainer">
    <input type="text" id="userInput" placeholder="Type here..." />
    <button id="sendBtn" onclick="sendMessage()">Send</button>
  </div>
  <script>
    const userName = "{{ user_name }}";
    const aiName = "{{ ai_name }}";
    const chatBox = document.getElementById("chatBox");
    const input = document.getElementById("userInput");
    async function sendMessage() {
        const msg = input.value.trim();
        if (!msg) return;
        input.value = "";
        const userContainer = document.createElement("div");
        userContainer.classList.add("message-container", "user-message-container");
        const userDiv = document.createElement("div");
        userDiv.classList.add("message", "user-message");
        userDiv.innerHTML = `<b>${userName}:</b> ${msg}`;
        userContainer.appendChild(userDiv);
        chatBox.appendChild(userContainer);
        chatBox.scrollTop = chatBox.scrollHeight;
        const typingContainer = document.createElement("div");
        typingContainer.classList.add("message-container", "ai-message-container");
        const typingDiv = document.createElement("div");
        typingDiv.classList.add("message", "ai-message", "typing");
        typingDiv.innerHTML = `<b>${aiName}:</b> <span class="dot"></span><span class="dot"></span><span class="dot"></span>`;
        const avatarImg = document.createElement("img");
        avatarImg.src = "/static/avatars/avatar.png";
        avatarImg.classList.add("avatar");

        avatarImg.onload = function() {
            typingContainer.appendChild(avatarImg);
            chatBox.appendChild(typingContainer);
            chatBox.scrollTop = chatBox.scrollHeight;
        };
        avatarImg.onerror = function() {
            const colorDiv = document.createElement("div");
            colorDiv.classList.add("avatar-fallback");
            colorDiv.style.backgroundColor = "#3498db";
            colorDiv.style.width = "50px";
            colorDiv.style.height = "50px";
            colorDiv.style.borderRadius = "50%";
            typingContainer.appendChild(colorDiv);
            chatBox.appendChild(typingContainer);
            chatBox.scrollTop = chatBox.scrollHeight;
        };

        typingContainer.appendChild(typingDiv);
        const response = await fetch("/chat_api", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({message: msg})
        });
        const data = await response.json();
        typingDiv.classList.remove("typing");
        typingDiv.innerHTML = `<b>${aiName}:</b> ${data.reply}`;
        chatBox.scrollTop = chatBox.scrollHeight;
    }
    input.addEventListener("keydown", function(event) {
        if (event.key === "Enter") {
            event.preventDefault();
            sendMessage();
        }
    });
</script>

</body>
</html>
